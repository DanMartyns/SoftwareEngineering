version : '3'

services :
        mysql : 
                image : 'mysql:latest'
                restart : always
                environment :
                        MYSQL_ROOT_PASSWORD: es
                        MYSQL_DATABASE : database
                        MYSQL_USER: User
                        MYSQL_PASSWORD: es
                networks :
                        global_network : 
                                ipv4_address : 172.16.238.10
                ports : 
                        - "3306:3306"
        main :
                build:
                    context: ./MainProject/dockerdemo
                    dockerfile: DockerFile
                restart : always
                networks : 
                        global_network :
                                ipv4_address : 172.16.238.20
                ports : 
                        - "8080:8080"  
                depends_on :
                    - mysql
                    - elasticsearch
        dashboard :
                build:
                        context: ./Dashboard/interface
                        dockerfile: Dockerfile
                volumes:
                        - './Dashboard/interface:/usr/src/app'
                        - '/usr/src/app/node_modules'
                networks:
                        global_network:
                                ipv4_address: 172.16.238.40
                ports:
                        - '3000:3000'
                environment:
                        - NODE_ENV=development
                depends_on:
                        - main
        elasticsearch:
                container_name : Elastic_Search
                build:
                        context: elasticsearch/
                volumes:
                        - ./elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml:ro
                ports:
                        - "9200:9200"
                        - "9300:9300"
                networks:
                        global_network:
                                ipv4_address: 172.16.238.60 
networks:
        global_network:
                driver : bridge
                ipam : 
                        driver : default
                        config : 
                                - subnet : 172.16.238.0/24
